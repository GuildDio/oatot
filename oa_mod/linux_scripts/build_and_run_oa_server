# Tip: You can create a supermake.local file and this script will get the variable from there.
BINNAME=openarena-server
MODNAME=oatot
# ARCH should be either i386 (32 bit) or x86_64 (64 bit).
ARCH=x86_64

# Usage.
usage() {
    echo "usage: $0 <port_number> <server_config>" >&2
    exit 1
}

# Check arguments number.
if (($# != 2)); then
    usage
fi

# Read port and server config arguments.
PORT=$1
CONFIG="$2"

if [ -r ./supermake.local ]; then
    source ./supermake.local
fi

if [ -r $BINNAME ] ; then
    echo $BINNAME found
else
    echo $BINNAME not found! Check the variables in the script
    exit 1
fi

# Create the mod dir.
mkdir -p ~/.openarena/$MODNAME

# Copy all the resources needed.
mkdir -p ../build/release-linux-$ARCH/$MODNAME
cp -r ../resources/* ../build/release-linux-$ARCH/$MODNAME

pushd ..
# Build, pak it and start.
make BASEGAME=$MODNAME && export LD_LIBRARY_PATH=$(readlink -f build/release-linux-$ARCH/${MODNAME}/go-client/) && cd build/release-linux-$ARCH/${MODNAME} && cp *.so ~/.openarena/$MODNAME && zip -r ~/.openarena/$MODNAME/$MODNAME.pk3 vm texts images models scripts gfx menu && $BINNAME +set fs_game $MODNAME +set dedicated 2 +set net_port $PORT +exec $CONFIG


popd
